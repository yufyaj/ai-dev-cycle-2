name: è‡ªå‹•ä¿®æ­£ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

on:
  issue_comment:
    types: [created]

permissions:
  contents: write
  issues: write
  pull-requests: write
  id-token: write

jobs:
  # PRã‚³ãƒ¡ãƒ³ãƒˆã‹ã©ã†ã‹ã‚’åˆ¤å®š
  check-pr-comment:
    runs-on: ubuntu-latest
    if: github.event.issue.pull_request != null
    outputs:
      is_fix_tests: ${{ steps.check.outputs.is_fix_tests }}
      is_apply_review: ${{ steps.check.outputs.is_apply_review }}
      pr_number: ${{ github.event.issue.number }}
    steps:
      - name: ã‚³ãƒ¡ãƒ³ãƒˆå†…å®¹ã‚’ç¢ºèª
        id: check
        run: |
          COMMENT_BODY="${{ github.event.comment.body }}"

          if [[ "$COMMENT_BODY" == "/fix-tests"* ]]; then
            echo "is_fix_tests=true" >> $GITHUB_OUTPUT
            echo "is_apply_review=false" >> $GITHUB_OUTPUT
          elif [[ "$COMMENT_BODY" == "/apply-review"* ]]; then
            echo "is_fix_tests=false" >> $GITHUB_OUTPUT
            echo "is_apply_review=true" >> $GITHUB_OUTPUT
          else
            echo "is_fix_tests=false" >> $GITHUB_OUTPUT
            echo "is_apply_review=false" >> $GITHUB_OUTPUT
          fi

  # /fix-tests ã‚³ãƒãƒ³ãƒ‰: ãƒ†ã‚¹ãƒˆå¤±æ•—ã‚’ä¿®æ­£
  fix-tests:
    runs-on: ubuntu-latest
    needs: check-pr-comment
    if: needs.check-pr-comment.outputs.is_fix_tests == 'true'

    steps:
      - name: PRãƒ–ãƒ©ãƒ³ãƒæƒ…å ±ã‚’å–å¾—
        id: comment-branch
        uses: xt0rted/pull-request-comment-branch@v3
        with:
          repo_token: ${{ secrets.GITHUB_TOKEN }}

      - name: PRãƒ–ãƒ©ãƒ³ãƒã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4
        with:
          ref: ${{ steps.comment-branch.outputs.head_ref }}
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0

      - name: å¯¾è±¡ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’åˆ¤åˆ¥
        id: detect-package
        run: |
          # å–å¾—ã—ãŸãƒ–ãƒ©ãƒ³ãƒåã‹ã‚‰å¯¾è±¡ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’åˆ¤å®š
          BRANCH_NAME="${{ steps.comment-branch.outputs.head_ref }}"
          echo "ãƒ–ãƒ©ãƒ³ãƒå: ${BRANCH_NAME}"

          if [[ $BRANCH_NAME == feature/frontend/* ]]; then
            PACKAGE="frontend"
          elif [[ $BRANCH_NAME == feature/backend/* ]]; then
            PACKAGE="backend"
          else
            PACKAGE="all"
          fi

          echo "package=${PACKAGE}" >> $GITHUB_OUTPUT
          echo "å¯¾è±¡ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸: ${PACKAGE}"

      - name: æœ€æ–°ã®ãƒ†ã‚¹ãƒˆå¤±æ•—ãƒ­ã‚°ã‚’å–å¾—
        id: get-test-logs
        run: |
          # ç›´è¿‘ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œã‹ã‚‰ãƒ†ã‚¹ãƒˆå¤±æ•—ãƒ­ã‚°ã‚’å–å¾—
          gh run list --workflow=pr-review.yml --json databaseId,conclusion,headBranch --limit 5 \
            | jq -r '.[] | select(.headBranch=="'$(git rev-parse --abbrev-ref HEAD)'") | select(.conclusion=="failure") | .databaseId' \
            | head -1 > run_id.txt

          if [ -s run_id.txt ]; then
            RUN_ID=$(cat run_id.txt)
            echo "run_id=${RUN_ID}" >> $GITHUB_OUTPUT
            echo "ãƒ†ã‚¹ãƒˆå¤±æ•—ã®Run ID: ${RUN_ID}"
          else
            echo "run_id=" >> $GITHUB_OUTPUT
            echo "ãƒ†ã‚¹ãƒˆå¤±æ•—ã®ãƒ­ã‚°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ"
          fi
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Claude Codeã§ãƒ†ã‚¹ãƒˆå¤±æ•—ã‚’ä¿®æ­£
        uses: anthropics/claude-code-action@v1
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          claude_args: "--allowedTools Write,Edit,Bash,Read,Glob,Grep"
          prompt: |
            ## ã‚¿ã‚¹ã‚¯
            PR #${{ needs.check-pr-comment.outputs.pr_number }} ã®ãƒ†ã‚¹ãƒˆå¤±æ•—ã‚’ä¿®æ­£ã—ã¦ãã ã•ã„ã€‚

            ## ğŸ“¦ å¯¾è±¡ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
            **${{ steps.detect-package.outputs.package }}** ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

            ## å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã®æƒ…å ±
            æœ€æ–°ã®ãƒ†ã‚¹ãƒˆå¤±æ•—ãƒ­ã‚°ã‚’ç¢ºèªã—ã€å¤±æ•—åŸå› ã‚’ç‰¹å®šã—ã¦ãã ã•ã„ï¼š
            ${{ steps.get-test-logs.outputs.run_id != '' && format('Run ID: {0}', steps.get-test-logs.outputs.run_id) || 'ãƒ­ã‚°ãŒè¦‹ã¤ã‹ã‚‰ãªã„ãŸã‚ã€ã‚³ãƒ¼ãƒ‰ã‚’åˆ†æã—ã¦ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã€å¤±æ•—åŸå› ã‚’ç‰¹å®šã—ã¦ãã ã•ã„' }}

            ## ä¿®æ­£æ–¹é‡
            1. **ãƒ†ã‚¹ãƒˆå¤±æ•—ã®åŸå› ã‚’ç‰¹å®š**
               - ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã®å•é¡Œï¼ˆä¸æ­£ç¢ºãªã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼é–“é•ã„ç­‰ï¼‰
               - å®Ÿè£…ã‚³ãƒ¼ãƒ‰ã®å•é¡Œï¼ˆãƒã‚°ã€ãƒ­ã‚¸ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼ç­‰ï¼‰
               - ç’°å¢ƒã®å•é¡Œï¼ˆä¾å­˜é–¢ä¿‚ã€è¨­å®šç­‰ï¼‰

            2. **é©åˆ‡ãªä¿®æ­£ã‚’å®Ÿæ–½**
               - ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã®å•é¡Œ â†’ ãƒ†ã‚¹ãƒˆã‚’ä¿®æ­£
               - å®Ÿè£…ã‚³ãƒ¼ãƒ‰ã®å•é¡Œ â†’ å®Ÿè£…ã‚’ä¿®æ­£
               - ä¸¡æ–¹ã«å•é¡ŒãŒã‚ã‚‹å ´åˆ â†’ ä¸¡æ–¹ä¿®æ­£

            3. **ä¿®æ­£å†…å®¹ã‚’ã‚³ãƒŸãƒƒãƒˆ**
               - ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: `ğŸ”§ fix: ãƒ†ã‚¹ãƒˆå¤±æ•—ã‚’è‡ªå‹•ä¿®æ­£ (#${{ needs.check-pr-comment.outputs.pr_number }})`
               - ä¿®æ­£ã—ãŸå†…å®¹ã‚’è©³ç´°ã«è¨˜è¼‰

            ## å®Œäº†æ¡ä»¶
            - ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã“ã¨
            - ä¿®æ­£å†…å®¹ãŒè«–ç†çš„ã«æ­£ã—ã„ã“ã¨
            - CLAUDE.mdã®è¦ç´„ã«æº–æ‹ ã—ã¦ã„ã‚‹ã“ã¨

            ## é‡è¦ãªæ³¨æ„äº‹é …
            - **çµ¶å¯¾ã«pushã—ãªã„ã§ãã ã•ã„**ï¼ˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒè‡ªå‹•ã§pushã—ã¾ã™ï¼‰
            - ä¿®æ­£å†…å®¹ã¯æœ€å°é™ã«ç•™ã‚ã‚‹
            - ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ã‹ã‚‰ã‚³ãƒŸãƒƒãƒˆ

      - name: å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆãƒ»ãƒ—ãƒƒã‚·ãƒ¥
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

          # å¤‰æ›´ãŒã‚ã‚‹å ´åˆã®ã¿ã‚³ãƒŸãƒƒãƒˆãƒ»push
          if [[ -n $(git status -s) ]]; then
            git add .
            git commit -m "ğŸ”§ fix: ãƒ†ã‚¹ãƒˆå¤±æ•—ã‚’è‡ªå‹•ä¿®æ­£ (#${{ needs.check-pr-comment.outputs.pr_number }})"

            # GITHUB_TOKENã‚’ä½¿ã£ã¦remote URLã‚’è¨­å®šï¼ˆèªè¨¼å•é¡Œã‚’è§£æ±ºï¼‰
            git remote set-url origin https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}.git

            # PRãƒ–ãƒ©ãƒ³ãƒã«push
            BRANCH_NAME="${{ steps.comment-branch.outputs.head_ref }}"
            git push origin HEAD:${BRANCH_NAME}

            echo "âœ… ã‚³ãƒŸãƒƒãƒˆãƒ»ãƒ—ãƒƒã‚·ãƒ¥å®Œäº†"
          else
            echo "å¤‰æ›´ãŒãªã„ãŸã‚ã‚³ãƒŸãƒƒãƒˆã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™"
          fi

      - name: ä¿®æ­£å®Œäº†ã‚’PRã«ã‚³ãƒ¡ãƒ³ãƒˆ
        run: |
          gh pr comment ${{ needs.check-pr-comment.outputs.pr_number }} --body "âœ… **ãƒ†ã‚¹ãƒˆå¤±æ•—ã®è‡ªå‹•ä¿®æ­£ãŒå®Œäº†ã—ã¾ã—ãŸ**

          Claude CodeãŒãƒ†ã‚¹ãƒˆå¤±æ•—ã‚’åˆ†æã—ã€ä¿®æ­£ã‚’é©ç”¨ã—ã¾ã—ãŸã€‚
          æœ€æ–°ã®ã‚³ãƒŸãƒƒãƒˆã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

          - ğŸ“ ä¿®æ­£å†…å®¹: ã‚³ãƒŸãƒƒãƒˆãƒ­ã‚°ã‚’ç¢ºèª
          - ğŸ”„ å†ãƒ†ã‚¹ãƒˆ: è‡ªå‹•çš„ã«å®Ÿè¡Œã•ã‚Œã¾ã™

          /cc @${{ github.event.comment.user.login }}"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: PRãƒ†ã‚¹ãƒˆã‚’å†å®Ÿè¡Œ
        run: |
          echo "PRãƒ†ã‚¹ãƒˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ãƒˆãƒªã‚¬ãƒ¼ã—ã¾ã™"
          BRANCH_NAME="${{ steps.comment-branch.outputs.head_ref }}"
          gh workflow run pr-review.yml --ref ${BRANCH_NAME}
          echo "âœ… ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã¾ã—ãŸ"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  # /apply-review ã‚³ãƒãƒ³ãƒ‰: ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®é‡è¦ãªæ”¹å–„ææ¡ˆã‚’é©ç”¨
  apply-review:
    runs-on: ubuntu-latest
    needs: check-pr-comment
    if: needs.check-pr-comment.outputs.is_apply_review == 'true'

    steps:
      - name: PRãƒ–ãƒ©ãƒ³ãƒæƒ…å ±ã‚’å–å¾—
        id: comment-branch
        uses: xt0rted/pull-request-comment-branch@v3
        with:
          repo_token: ${{ secrets.GITHUB_TOKEN }}

      - name: PRãƒ–ãƒ©ãƒ³ãƒã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4
        with:
          ref: ${{ steps.comment-branch.outputs.head_ref }}
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0

      - name: å¯¾è±¡ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’åˆ¤åˆ¥
        id: detect-package
        run: |
          # å–å¾—ã—ãŸãƒ–ãƒ©ãƒ³ãƒåã‹ã‚‰å¯¾è±¡ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’åˆ¤å®š
          BRANCH_NAME="${{ steps.comment-branch.outputs.head_ref }}"
          echo "ãƒ–ãƒ©ãƒ³ãƒå: ${BRANCH_NAME}"

          if [[ $BRANCH_NAME == feature/frontend/* ]]; then
            PACKAGE="frontend"
          elif [[ $BRANCH_NAME == feature/backend/* ]]; then
            PACKAGE="backend"
          else
            PACKAGE="all"
          fi

          echo "package=${PACKAGE}" >> $GITHUB_OUTPUT
          echo "å¯¾è±¡ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸: ${PACKAGE}"

      - name: Claude Codeãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—
        id: get-review
        run: |
          # Claudeã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—
          gh pr view ${{ needs.check-pr-comment.outputs.pr_number }} --json comments \
            | jq -r '.comments[] | select(.author.login=="claude" or .author.login=="github-actions[bot]") | select(.body | contains("ğŸ” ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœ")) | .body' \
            | head -1 > review.txt

          if [ -s review.txt ]; then
            echo "has_review=true" >> $GITHUB_OUTPUT
            echo "ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆã‚’å–å¾—ã—ã¾ã—ãŸ"
          else
            echo "has_review=false" >> $GITHUB_OUTPUT
            echo "ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ"
          fi
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Claude Codeã§ãƒ¬ãƒ“ãƒ¥ãƒ¼æŒ‡æ‘˜ã‚’ä¿®æ­£
        if: steps.get-review.outputs.has_review == 'true'
        uses: anthropics/claude-code-action@v1
        with:
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          claude_args: "--allowedTools Write,Edit,Bash,Read,Glob,Grep"
          prompt: |
            ## ã‚¿ã‚¹ã‚¯
            PR #${{ needs.check-pr-comment.outputs.pr_number }} ã®ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼æŒ‡æ‘˜äº‹é …ã‚’ä¿®æ­£ã—ã¦ãã ã•ã„ã€‚

            ## ğŸ“¦ å¯¾è±¡ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
            **${{ steps.detect-package.outputs.package }}** ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

            ## ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœ
            æœ€æ–°ã®Claude Codeãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š
            ```
            $(cat review.txt)
            ```

            ## ä¿®æ­£å¯¾è±¡
            ä»¥ä¸‹ã®é …ç›®ã®ã¿ã‚’ä¿®æ­£ã—ã¦ãã ã•ã„ï¼š
            1. **ğŸš¨ é‡å¤§ãªå•é¡Œ**: ã™ã¹ã¦ä¿®æ­£å¿…é ˆ
            2. **âš ï¸ æ”¹å–„ææ¡ˆ**: é‡è¦åº¦ã®é«˜ã„ã‚‚ã®ã®ã¿ä¿®æ­£
               - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã«é–¢ã‚ã‚‹ææ¡ˆ
               - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«å¤§ããå½±éŸ¿ã™ã‚‹ææ¡ˆ
               - ãƒã‚°ã«ã¤ãªãŒã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ææ¡ˆ

            ## ä¿®æ­£æ–¹é‡
            - è»½å¾®ãªææ¡ˆï¼ˆã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã€ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ ç­‰ï¼‰ã¯ç„¡è¦–ã—ã¦OK
            - å®Ÿè£…ã®æœ¬è³ªã‚’å¤‰ãˆã‚‹ææ¡ˆã¯æ…é‡ã«åˆ¤æ–­
            - ä¿®æ­£å†…å®¹ã¯æœ€å°é™ã«ç•™ã‚ã‚‹
            - CLAUDE.mdã®è¦ç´„ã«æº–æ‹ 

            ## å®Œäº†æ¡ä»¶
            - é‡å¤§ãªå•é¡ŒãŒã™ã¹ã¦è§£æ±ºã—ã¦ã„ã‚‹ã“ã¨
            - ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã“ã¨
            - ä¿®æ­£å†…å®¹ãŒè«–ç†çš„ã«æ­£ã—ã„ã“ã¨

            ## é‡è¦ãªæ³¨æ„äº‹é …
            - **çµ¶å¯¾ã«pushã—ãªã„ã§ãã ã•ã„**ï¼ˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒè‡ªå‹•ã§pushã—ã¾ã™ï¼‰
            - ä¿®æ­£ã—ãŸå†…å®¹ã‚’ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«è¨˜è¼‰

      - name: å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆãƒ»ãƒ—ãƒƒã‚·ãƒ¥
        if: steps.get-review.outputs.has_review == 'true'
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

          # å¤‰æ›´ãŒã‚ã‚‹å ´åˆã®ã¿ã‚³ãƒŸãƒƒãƒˆãƒ»push
          if [[ -n $(git status -s) ]]; then
            git add .
            git commit -m "â™»ï¸ refactor: ãƒ¬ãƒ“ãƒ¥ãƒ¼æŒ‡æ‘˜äº‹é …ã‚’è‡ªå‹•ä¿®æ­£ (#${{ needs.check-pr-comment.outputs.pr_number }})"

            # GITHUB_TOKENã‚’ä½¿ã£ã¦remote URLã‚’è¨­å®šï¼ˆèªè¨¼å•é¡Œã‚’è§£æ±ºï¼‰
            git remote set-url origin https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}.git

            # PRãƒ–ãƒ©ãƒ³ãƒã«push
            BRANCH_NAME="${{ steps.comment-branch.outputs.head_ref }}"
            git push origin HEAD:${BRANCH_NAME}

            echo "âœ… ã‚³ãƒŸãƒƒãƒˆãƒ»ãƒ—ãƒƒã‚·ãƒ¥å®Œäº†"
          else
            echo "å¤‰æ›´ãŒãªã„ãŸã‚ã‚³ãƒŸãƒƒãƒˆã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™"
          fi

      - name: ä¿®æ­£å®Œäº†ã‚’PRã«ã‚³ãƒ¡ãƒ³ãƒˆ
        if: steps.get-review.outputs.has_review == 'true'
        run: |
          gh pr comment ${{ needs.check-pr-comment.outputs.pr_number }} --body "âœ… **ãƒ¬ãƒ“ãƒ¥ãƒ¼æŒ‡æ‘˜äº‹é …ã®è‡ªå‹•ä¿®æ­£ãŒå®Œäº†ã—ã¾ã—ãŸ**

          Claude CodeãŒãƒ¬ãƒ“ãƒ¥ãƒ¼ã®é‡è¦ãªæ”¹å–„ææ¡ˆã‚’é©ç”¨ã—ã¾ã—ãŸã€‚
          æœ€æ–°ã®ã‚³ãƒŸãƒƒãƒˆã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

          - ğŸ“ ä¿®æ­£å†…å®¹: ã‚³ãƒŸãƒƒãƒˆãƒ­ã‚°ã‚’ç¢ºèª
          - ğŸ”„ å†ãƒ†ã‚¹ãƒˆ: è‡ªå‹•çš„ã«å®Ÿè¡Œã•ã‚Œã¾ã™

          /cc @${{ github.event.comment.user.login }}"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: PRãƒ†ã‚¹ãƒˆã‚’å†å®Ÿè¡Œ
        if: steps.get-review.outputs.has_review == 'true'
        run: |
          echo "PRãƒ†ã‚¹ãƒˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ãƒˆãƒªã‚¬ãƒ¼ã—ã¾ã™"
          BRANCH_NAME="${{ steps.comment-branch.outputs.head_ref }}"
          gh workflow run pr-review.yml --ref ${BRANCH_NAME}
          echo "âœ… ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã¾ã—ãŸ"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆæœªæ¤œå‡ºæ™‚ã®é€šçŸ¥
        if: steps.get-review.outputs.has_review == 'false'
        run: |
          gh pr comment ${{ needs.check-pr-comment.outputs.pr_number }} --body "âš ï¸ **ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ**

          Claude Codeã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆãŒè¦‹ã¤ã‹ã‚‰ãªã„ãŸã‚ã€ä¿®æ­£ã‚’å®Ÿè¡Œã§ãã¾ã›ã‚“ã§ã—ãŸã€‚
          å…ˆã«PRè‡ªå‹•ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

          /cc @${{ github.event.comment.user.login }}"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
