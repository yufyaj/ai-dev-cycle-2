# 要件定義書作成ガイド（対話型）

このドキュメントは、Claude Codeがユーザーと対話しながら要件定義書を作成する際の準拠事項です。

## 基本フロー

```
1. 初期情報の収集
   ↓
2. 段階的な詳細化（対話）
   ↓
3. 要件定義書の作成
   ↓
4. 確認・修正
   ↓
5. Issue/Sub-Issue作成
```

## Step 1: 初期情報の収集

ユーザーから以下の情報を収集します。

### 必須質問

```
質問1: どのような機能を作りたいですか？
例: 「ユーザー認証機能」「データエクスポート機能」

質問2: なぜこの機能が必要ですか？（背景・目的）
例: 「現在は誰でもアクセスできるが、ユーザーごとにパーソナライズしたい」

質問3: この機能が完成したら、どのような状態になりますか？（受け入れ基準）
例: 「ユーザーがログインして、自分専用のダッシュボードを見られる」
```

### プロジェクト情報の確認

```
質問4: Frontend/Backend どちらが関わりますか？
- Frontend のみ
- Backend のみ
- 両方

質問5: 使用している技術スタックは何ですか？
例: 「React + Node.js + PostgreSQL」
```

## Step 2: 段階的な詳細化

初期情報を元に、段階的に詳細を詰めていきます。

### 2-1: 機能要件の深掘り

```
質問: この機能には、具体的にどのような要素が必要ですか？

例（認証機能の場合）:
- ログイン機能
- ログアウト機能
- パスワードリセット
- アカウントロック（セキュリティ）
- Remember me機能

ガイド:
「以下のような要素が考えられますが、他に必要なものはありますか？」
と提案しながら進める
```

### 2-2: UI/UX要件（Frontendがある場合）

```
質問: どのような画面が必要ですか？

例:
- ログイン画面
- パスワードリセット画面
- エラー表示

質問: 画面にはどのような要素が必要ですか？

例（ログイン画面）:
- メールアドレス入力フィールド
- パスワード入力フィールド
- ログインボタン
- 「パスワードを忘れた」リンク
```

### 2-3: データ・API仕様（Backendがある場合）

```
質問: どのようなデータを扱いますか？

例:
- ユーザー情報（ID、メール、パスワード）
- ログイン履歴
- セッション情報

質問: どのようなAPIエンドポイントが必要ですか？

例:
- POST /api/auth/login
- POST /api/auth/logout
- POST /api/auth/reset-password
```

### 2-4: 非機能要件

```
質問: パフォーマンス要件はありますか？
例: 「ログインは500ms以内」

質問: セキュリティ要件はありますか？
例: 「パスワードはハッシュ化、5回失敗でロック」

質問: スケーラビリティ要件はありますか？
例: 「同時ログイン1000人まで対応」
```

### 2-5: 制約・前提条件

```
質問: 技術的な制約や前提条件はありますか？

例:
- 既存のユーザーテーブルを使う
- OAuth は使わない
- HTTPS必須
```

### 2-6: テストシナリオ

```
質問: どのようなケースをテストする必要がありますか？

正常系:
- 正しい認証情報でログイン成功

異常系:
- 間違ったパスワードでエラー表示

エッジケース:
- 空の入力値
- 無効なメールアドレス形式
```

## Step 3: 要件定義書の作成

収集した情報を元に、要件定義書を作成します。

### ディレクトリ・ファイル命名規則

```
ai-docs/requirements/{連番}-{機能名}/
└── requirement.md
```

**連番ルール:**
- 3桁のゼロパディング（001, 002, 003...）
- 既存の最大連番 + 1

**機能名ルール:**
- ケバブケース（小文字、ハイフン区切り）
- 英語推奨

**例:**
```
ai-docs/requirements/
├── _guides/          # ガイドライン（固定）
├── 001-user-auth/    # ユーザー認証
│   └── requirement.md
├── 002-data-export/  # データエクスポート
│   └── requirement.md
└── 003-dashboard/    # ダッシュボード
    └── requirement.md
```

### 連番の決定方法

```bash
# 既存ディレクトリを確認
ls ai-docs/requirements/

# 最大の連番を確認して +1
# 例: 002-data-export が最新なら、次は 003
```

### 要件定義書のテンプレート

`ai-docs/requirements/_guides/template.md` を使用して作成します。

### 作成時の注意点

1. **具体的に記述**: 曖昧な表現を避ける
2. **テスト可能に**: 受け入れ基準は検証可能な形式
3. **網羅的に**: 漏れがないようリストアップ
4. **優先順位付け**: 重要度・緊急度を明記

## Step 4: 確認・修正

要件定義書をユーザーに提示し、確認してもらいます。

```
確認ポイント:
- 機能要件に漏れはないか
- 受け入れ基準は明確か
- 技術的な制約は反映されているか
- 優先順位は適切か
```

### 修正が必要な場合

ユーザーのフィードバックを元に修正します。

```
「〇〇の部分を修正します」と明示的に伝える
修正後、再度確認を求める
```

## Step 5: Issue/Sub-Issue作成

要件定義書が完成したら、Issue/Sub-Issueを作成します。

### 作成プロンプト（自動実行）

```
【要件定義書】
ai-docs/requirements/{連番}-{機能名}/requirement.md

【準拠事項】
ai-docs/requirements/_guides/issue-creation-guide.md に従ってください

【重要】
Sub-issue作成時は `frontend` または `backend` ラベルのみを付与し、
`tdd-implement:*` ラベルは付与しないでください。

【手順】
1. 要件定義書を分析
2. 親Issueを作成（gh issue create）
3. 機能をfrontend/backend別のSub-Issueに分割
4. gh-sub-issueで各Sub-Issueを作成
5. 実装順序を推奨

作成したIssueのURL一覧を報告してください。
```

## ユーザー向け推奨プロンプト

ユーザーが要件定義書作成を開始する際の推奨プロンプト：

```
【シンプル版】
「〇〇機能の要件定義書を一緒に作ってください」

【詳細版】
「以下の機能の要件定義書を作成し、親IssueとSub-Issueを作成してください：
- 機能名: 〇〇
- 概要: △△
- 目的: □□

ai-docs/requirements/_guides/requirements-creation-guide.md に従って、
対話しながら詳細を詰めていってください。」
```

## 対話例

### 例1: ユーザー認証機能

```
User: ユーザー認証機能の要件定義書を一緒に作ってください

Claude Code:
承知しました！ユーザー認証機能の要件定義書を作成します。
いくつか質問させてください。

1. なぜユーザー認証機能が必要ですか？（背景・目的）

User: 現在は誰でもアクセスできる状態だけど、ユーザーごとにパーソナライズしたい

Claude Code:
なるほど。では次の質問です。

2. この機能が完成したら、どのような状態になりますか？

User: ユーザーがログインして、自分専用のダッシュボードを見られる

Claude Code:
ありがとうございます。次は具体的な機能について伺います。

3. 認証機能には以下のような要素が考えられますが、どれが必要ですか？
   - ログイン機能 ✅
   - ログアウト機能 ✅
   - パスワードリセット
   - Remember me機能
   - アカウントロック（セキュリティ）

他に必要なものはありますか？

User: パスワードリセットとアカウントロックも欲しい

Claude Code:
承知しました。では技術的な詳細について伺います。

4. 使用している技術スタックは何ですか？

User: React + Node.js + PostgreSQL

Claude Code:
ありがとうございます。ではセキュリティ要件について...

（このように段階的に質問を続ける）

...

Claude Code:
要件定義書を作成しました！
ディレクトリ: ai-docs/requirements/001-user-auth/
ファイル: requirement.md

内容を確認してください。修正が必要であればお知らせください。

User: OKです

Claude Code:
それでは、この要件定義書から親IssueとSub-Issueを作成します...

（Issue作成処理を実行）

完了しました！作成したIssue:
- 親Issue: #123 [Epic] ユーザー認証機能
- Sub-Issue: #124 [backend] JWTトークン生成機能の実装
- Sub-Issue: #125 [backend] ログインAPIエンドポイントの実装
...
```

## 質問のベストプラクティス

### 良い質問の例

✅ **具体的で答えやすい**
```
「ログイン画面にはどのような入力フィールドが必要ですか？」
```

✅ **選択肢を提示**
```
「セキュリティ要件として、以下のどれが必要ですか？
- パスワードのハッシュ化
- アカウントロック機能
- 二要素認証」
```

✅ **例を示す**
```
「パフォーマンス要件はありますか？
例: ログインは500ms以内、など」
```

### 悪い質問の例

❌ **曖昧すぎる**
```
「他に何か必要ですか？」
```

❌ **専門用語が多すぎる**
```
「OAuth 2.0 の Authorization Code Flow を使用しますか？それとも Implicit Flow ですか？」
→ 必要に応じて説明を加える
```

❌ **一度に多すぎる**
```
「機能要件、非機能要件、UI仕様、API仕様、データモデル、テストシナリオを全て教えてください」
→ 段階的に質問する
```

## エラーハンドリング

### ユーザーの回答が不明確な場合

```
「申し訳ありませんが、もう少し具体的に教えていただけますか？

例えば:
- 〇〇の場合はAですか？
- それとも△△の場合はBですか？」
```

### 技術的に矛盾がある場合

```
「確認ですが、〇〇と△△は矛盾しているように見えます。
どちらを優先すべきでしょうか？」
```

### 情報が不足している場合

```
「〇〇について教えていただけますか？
これがないと、実装時に問題が発生する可能性があります。」
```

## 完了基準

要件定義書が完成したと判断する基準：

- [ ] 機能名が明確
- [ ] 背景・目的が説明されている
- [ ] 受け入れ基準が具体的
- [ ] 機能要件が網羅的
- [ ] 非機能要件が含まれている
- [ ] UI/UX要件（Frontendの場合）
- [ ] API/データ仕様（Backendの場合）
- [ ] テストシナリオがリストアップされている
- [ ] 制約・前提条件が明記されている
- [ ] ユーザーが内容を確認・承認した

## 参考資料

- `ai-docs/requirements/_guides/template.md` - 要件定義書テンプレート
- `ai-docs/requirements/_guides/issue-creation-guide.md` - Issue作成ガイドライン
