# 要件定義書テンプレート

> このテンプレートを使って要件定義書を作成してください。
> 作成後、Claude Codeに渡すと自動的に親IssueとSub-Issueが作成されます。

## 機能名

{機能の名前を記述}

例: ユーザー認証機能

---

## 概要

{機能の概要を1-3文で説明}

例:
ユーザーがメールアドレスとパスワードでログイン・ログアウトできる機能を実装します。セッション管理にはJWTトークンを使用し、セキュアな認証を実現します。

---

## 背景・目的

{なぜこの機能が必要なのか、どのようなビジネス価値があるのかを説明}

例:
現在、アプリケーションには認証機能がなく、誰でもアクセスできる状態です。ユーザーごとにパーソナライズされた体験を提供し、データのセキュリティを確保するために、認証機能が必要です。

### 期待される効果
- {効果1}
- {効果2}

---

## 受け入れ基準

> 全体として、この機能がどのような状態になれば「完成」と言えるかを具体的に記述

- [ ] {基準1: 具体的でテスト可能な条件}
- [ ] {基準2: 具体的でテスト可能な条件}
- [ ] {基準3: 具体的でテスト可能な条件}

例:
- [ ] ユーザーが正しいメールアドレスとパスワードでログインできる
- [ ] ログイン後、ユーザー専用のダッシュボードが表示される
- [ ] ログアウトボタンをクリックすると、ログイン画面に戻る
- [ ] ログイン状態が24時間保持される
- [ ] 不正な認証情報の場合、適切なエラーメッセージが表示される

---

## 機能要件

### {カテゴリ1}

例: 認証機能

- {要件1}
- {要件2}
- {要件3}

例:
- メールアドレスとパスワードによるログイン
- JWTトークンによるセッション管理
- トークンの自動リフレッシュ機能
- ログアウト機能
- パスワードリセット機能（メール送信）

### {カテゴリ2}

例: バリデーション

- {要件1}
- {要件2}

例:
- メールアドレス形式のバリデーション
- パスワードは8文字以上、英数字混在必須
- 5回連続ログイン失敗でアカウントロック（15分間）

### {カテゴリ3}

例: UI/UX

- {要件1}
- {要件2}

例:
- ログインフォームはシンプルで直感的
- ローディング中はスピナーを表示
- エラーメッセージは赤色で明確に表示

---

## 非機能要件

### パフォーマンス
- {具体的な数値目標}

例:
- ログイン処理は500ms以内に完了
- APIレスポンスタイムは平均200ms以下

### セキュリティ
- {セキュリティ要件}

例:
- パスワードはbcryptでハッシュ化して保存
- JWTトークンは有効期限付き（24時間）
- HTTPS通信必須
- CSRFトークンによる保護

### 可用性
- {可用性要件}

例:
- サービス稼働率99.9%以上
- 認証サービスのダウンタイムは月間1時間以内

### スケーラビリティ
- {スケーラビリティ要件}

例:
- 同時ログインユーザー1000人まで対応
- 将来的に10000人まで拡張可能な設計

---

## 制約・前提条件

- {制約1}
- {制約2}

例:
- バックエンドはNode.js + Express
- フロントエンドはReact
- データベースはPostgreSQL
- 外部の認証サービス（OAuth）は使用しない
- 既存のユーザーテーブルを利用

---

## UI/UX要件（該当する場合）

### 画面構成

#### ログイン画面
- {要素1}
- {要素2}

例:
- メールアドレス入力フィールド
- パスワード入力フィールド（マスキング）
- 「ログイン」ボタン
- 「パスワードを忘れた場合」リンク
- エラーメッセージ表示エリア

#### ダッシュボード（ログイン後）
- {要素1}
- {要素2}

例:
- ユーザー名表示
- 「ログアウト」ボタン
- ナビゲーションメニュー

### デザインガイドライン
- {ガイドライン1}
- {ガイドライン2}

例:
- プライマリカラー: #0066CC
- ボタンの角丸: 4px
- フォント: Noto Sans JP

---

## データ仕様（該当する場合）

### データモデル

#### User（ユーザーテーブル）
```
{
  id: UUID (主キー),
  email: String (一意、必須),
  password_hash: String (必須),
  created_at: Timestamp,
  updated_at: Timestamp,
  last_login_at: Timestamp,
  failed_login_attempts: Integer (デフォルト: 0),
  locked_until: Timestamp (null可)
}
```

### API仕様

#### POST /api/auth/login
**リクエスト:**
```json
{
  "email": "user@example.com",
  "password": "password123"
}
```

**レスポンス（成功）:**
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": "uuid",
    "email": "user@example.com"
  }
}
```

**レスポンス（失敗）:**
```json
{
  "error": "メールアドレスまたはパスワードが正しくありません"
}
```

#### POST /api/auth/logout
**リクエスト:**
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

**レスポンス:**
```json
{
  "message": "ログアウトしました"
}
```

---

## テストシナリオ

> 主要なテストケースをリストアップ

### 正常系
1. {シナリオ1}
2. {シナリオ2}

例:
1. 正しいメールアドレスとパスワードでログインし、ダッシュボードにリダイレクトされる
2. ログアウトボタンをクリックし、ログイン画面に戻る
3. ログイン状態が24時間保持される

### 異常系
1. {シナリオ1}
2. {シナリオ2}

例:
1. 存在しないメールアドレスでログインを試み、エラーメッセージが表示される
2. 間違ったパスワードでログインを試み、エラーメッセージが表示される
3. 5回連続でログイン失敗し、アカウントがロックされる

### エッジケース
1. {シナリオ1}
2. {シナリオ2}

例:
1. 空のメールアドレスでログインを試みる
2. 無効な形式のメールアドレスでログインを試みる
3. 8文字未満のパスワードでログインを試みる
4. トークンの有効期限が切れた状態でAPIにアクセスする

---

## 依存関係

### 前提となる機能・タスク
- {依存する機能1}
- {依存する機能2}

例:
- データベースマイグレーション（ユーザーテーブル作成）
- メール送信機能（パスワードリセット用）

### この機能に依存する機能
- {この機能に依存する機能1}
- {この機能に依存する機能2}

例:
- プロフィール編集機能
- マイページ表示機能

---

## 技術スタック（推奨）

### Frontend
- {技術1}
- {技術2}

例:
- React 18
- React Router
- Axios (HTTP client)
- React Hook Form (フォーム管理)

### Backend
- {技術1}
- {技術2}

例:
- Node.js 20
- Express
- jsonwebtoken (JWT)
- bcrypt (パスワードハッシュ化)
- Prisma (ORM)

### Database
- {データベース}

例:
- PostgreSQL 15

---

## 実装の優先順位

> Sub-issueの実装順序の推奨

1. {優先度1のタスク}
2. {優先度2のタスク}
3. {優先度3のタスク}

例:
1. JWTトークン生成機能（Backend）
2. ログインAPIエンドポイント（Backend）
3. ログアウトAPIエンドポイント（Backend）
4. ログインフォーム（Frontend）
5. 認証状態管理（Frontend）
6. パスワードリセット機能（Backend → Frontend）

---

## リスク・懸念事項

- {リスク1}
- {リスク2}

例:
- JWTトークンの盗難リスク → HTTPSとSecure Cookie で対策
- パスワード総当たり攻撃 → レート制限とアカウントロック機能で対策
- セッション固定攻撃 → トークンの定期的なリフレッシュで対策

---

## 参考資料

- {資料1}
- {資料2}

例:
- [JWT公式ドキュメント](https://jwt.io/)
- [OWASP認証チートシート](https://cheatsheetseries.owasp.org/cheatsheets/Authentication_Cheat_Sheet.html)
- 社内認証ガイドライン

---

## 備考・その他

{その他の補足情報があれば記述}

例:
- 将来的にはOAuth（Google、GitHub）によるソーシャルログインも検討
- 二要素認証（2FA）は次フェーズで実装予定
